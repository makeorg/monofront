image: makeorg/docker-arch-docker:latest

variables: &global_variables
  IMAGE: "make-front"
  YARN_VERSION: "1.22.5"

cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - ~/.cache
    - node_modules

stages:
  - check

.check:
  stage: check
  image: "node:12.22-alpine"
  except:
    - production
  before_script:
    - node -v
    - yarn install --check-files

lint:
  extends: .check
  script:
    - yarn eslint ./apps ./ui ./components ./utils ./api ./store

check-types:
  extends: .check
  script:
    - yarn tsc --noEmit

test:
  extends: .check
  script:
    - yarn jest --coverage
  artifacts:
    expire_in: 1 week
    when: always
    paths:
      - coverage

jscpd:
  extends: .check
  script:
    - yarn jscpd
  artifacts:
    expire_in: 1 week
    when: always
    paths:
      - reports
